# Документация модуля simai.mscore

## Структура файлов и папок

```markdown
simai.mscore/
├── include.php
├── admin/
│   └── iblock.element.edit.php
├── install/
│   ├── index.php
│   └── version.php
├── lib/
│   ├── block/
│   │   └── edit.php
│   ├── config/
│   │   └── site.php
│   ├── configuration/
│   │   ├── iblock.php
│   │   └── transfer.php
│   ├── disk/
│   │   └── disk.php
│   ├── fileman/
│   │   └── property.php
│   ├── highload/
│   │   └── search.php
│   ├── io/
│   │   ├── include_area.php
│   │   └── setting.php
│   └── subsite/
│       ├── coordinate.php
│       └── tree.php
└── scripts/
    └── create_site.php
```

## include.php

Путь: include.php


### Константы

- **SF_SOLUTION_NAME**: Константа, которая содержит название решения SIMAI. Она определяется на основе сообщения из локализации через класс Loc.
- **SF_SOLUTION_LINK**: Константа, которая содержит ссылку на решение SIMAI. Определяется через локализированное сообщение.

Эти константы используются для установки метаинформации страницы в решении.

### Классы

- **\Bitrix\Main\Page\Asset**: Класс Bitrix для работы с активами страницы. Используется для добавления строк, таких как метатеги, скрипты и стили, к странице. В данном файле используется для добавления авторских данных и информации о решении SIMAI.

- **Loc**: Класс Bitrix для локализации. Используется для загрузки сообщений на нужном языке. В этом файле с его помощью определяются сообщения, связанные с названием, автором и ссылкой на решение SIMAI.

## admin

Путь: admin

Папка содержит административные файлы, связанные с редактированием элементов инфоблока.
В этой папке находится следующий файл:

- iblock.element.edit.php: Файл, отвечающий за редактирование элементов инфоблока в административной панели.
## iblock.element.edit.php

Путь: admin/iblock.element.edit.php


### Классы

- **\SIMAI\Main\Configuration\Property**: Класс, который отвечает за работу с пользовательскими свойствами в конфигурации. Используется для получения и установки свойств, связанных с элементами инфоблока.

- **\SIMAI\Main\Subsite\Verification**: Класс, который отвечает за проверку прав доступа и корректности настроек подсайтов. Используется для верификации перед выполнением критичных операций.

- **\Bitrix\Main\Page\Asset**: Класс для управления активами страницы в Bitrix. Используется для подключения стилей и скриптов в административной панели.

- **\SIMAI\Main\Subsite\Coordinate**: Класс, отвечающий за работу с координатами и настройками подсайтов.

## install

Путь: install

Папка содержит файлы, связанные с установкой модуля. Включает следующие файлы:

- index.php: Основной файл установки модуля, содержащий логику запуска инсталляции.
- version.php: Файл, содержащий информацию о версии модуля.
## index.php

Путь: install/index.php


### Классы

- **simai_mscore**: Класс модуля, наследующий от CModule. Он содержит информацию о модуле, такой как версия, описание и методы для установки и удаления.

### Методы

- **InstallDB**: Метод для установки базы данных модуля. В текущей версии он возвращает true без дополнительных операций.
- **UnInstallDB**: Метод для удаления базы данных модуля. В текущей версии также возвращает true без дополнительных операций.
- **InstallEvents**: Метод для регистрации событий модуля. В текущей версии возвращает true.
- **UnInstallEvents**: Метод для удаления зарегистрированных событий модуля. Возвращает true.
## version.php

Путь: install/version.php


### Константы

- **$arModuleVersion**: Массив, содержащий информацию о версии модуля. Включает следующие параметры:
    - VERSION: "1.0.0" — версия модуля.
    - VERSION_DATE: "2015-12-01 18:03:07" — дата выпуска данной версии.

## lib

Путь: lib

Папка содержит различные компоненты модуля, включая конфигурационные файлы, файлы для работы с инфоблоками, highload-блоками, подсайтами и управлением ресурсами. Включает следующие папки и файлы:

- block/edit.php
- config/site.php
- configuration/iblock.php
- configuration/transfer.php
- disk/disk.php
- fileman/property.php
- highload/search.php
- io/include_area.php
- io/setting.php
- subsite/coordinate.php
- subsite/tree.php
## edit.php

Путь: lib/block/edit.php


### Классы

- **Edit**: Класс, относящийся к пространству имён SIMAI\Main\Block, отвечает за редактирование и добавление элементов блоков.

### Методы

- **addEditTag2Area**: Метод добавляет тег для редактирования элемента на странице. Используется для интеграции с Bitrix и позволяет отображать редактируемые области на странице для авторизованных пользователей.

## config

Путь: lib/config

Папка содержит конфигурационные файлы модуля, в том числе настройки для сайта. Включает следующие файлы:

- site.php: Файл, содержащий конфигурацию для сайта.
## site.php

Путь: lib/config/site.php


### Классы

- **Site**: Класс, относящийся к пространству имён SIMAI\Main\Config. Он отвечает за работу с конфигурациями сайта.

### Методы

- **get**: Метод возвращает конфигурацию для указанного типа, объединяя системные и пользовательские конфигурационные файлы. Проверяет наличие файлов конфигурации и, если они существуют, объединяет данные из системных и пользовательских конфигураций.

## configuration

Путь: lib/configuration

Папка содержит конфигурационные файлы, связанные с инфоблоками и передачей данных. Включает следующие файлы:

- iblock.php: Конфигурация для работы с инфоблоками.
- transfer.php: Конфигурация для передачи данных.
## iblock.php

Путь: lib/configuration/iblock.php


### Классы

- **Iblock**: Класс, относящийся к пространству имён SIMAI\Main\Configuration. Он управляет конфигурациями инфоблоков.

### Методы

- **getValue**: Метод для получения значения конфигурации инфоблока. Если значение отсутствует, оно автоматически устанавливается.
- **setValue**: Метод для установки значения конфигурации инфоблока. Сохраняет значение в конфигурации.
- **getInstance**: Метод, возвращающий экземпляр класса Iblock (реализует паттерн Singleton).
## transfer.php

Путь: lib/configuration/transfer.php


### Классы

- **Transfer**: Класс, относящийся к пространству имён SIMAI\Main\Configuration. Он управляет передачей данных между компонентами модуля.

### Методы

- **getValue**: Метод для получения значения из конфигурации.
- **setValue**: Метод для установки значения в конфигурацию.
- **getInstance**: Метод, возвращающий экземпляр класса Transfer (реализует паттерн Singleton).
- **add**: Метод для добавления значения в конфигурацию.
- **delete**: Метод для удаления значения из конфигурации.

## disk

Путь: lib/disk

Папка содержит файлы, связанные с управлением дисковым пространством. Включает следующий файл:

- disk.php: Файл для работы с дисковым пространством.
## disk.php

Путь: lib/disk/disk.php


### Классы

- **Disk**: Класс, относящийся к пространству имён SIMAI\Disk. Он отвечает за работу с добавлением данных в highload-блоки Bitrix.

### Методы

- **add**: Метод для добавления файлов в highload-блок. Выполняет проверку перед добавлением, а также управляет полями, связанными с медиа и инфоблоками.

## fileman

Путь: lib/fileman

Папка содержит файлы для работы с управлением файлами. Включает следующий файл:

- property.php: Файл для работы с пользовательскими свойствами файлов.
## property.php

Путь: lib/fileman/property.php


### Классы

- **Property**: Класс, относящийся к пространству имён SIMAI\Main\Fileman. Он отвечает за работу с пользовательскими свойствами файлов.

### Методы

- **SetPageTitle**: Метод для изменения заголовка страницы. Выполняет замену заголовка в файле prolog на переданное значение.

## highload

Путь: lib/highload

Папка содержит файлы для работы с highload-блоками в системе. Включает следующий файл:

- search.php: Файл для обработки поиска в highload-блоках.
## search.php

Путь: lib/highload/search.php


### Классы

- **Search**: Класс, относящийся к пространству имён SIMAI\Highload. Он отвечает за обработку поиска в highload-блоках.

### Методы

- **OnSearchReindex**: Метод для индексирования данных highload-блоков. Использует конфигурационные файлы для управления индексируемыми полями.

## io

Путь: lib/io

Папка содержит файлы, связанные с вводом и выводом данных. Включает следующие файлы:

- include_area.php: Файл для работы с включаемыми областями на странице.
- setting.php: Файл для управления настройками ввода-вывода.
## include_area.php

Путь: lib/io/include_area.php


### Классы

- **IncludeArea**: Класс, относящийся к пространству имён SIMAI\Main\IO. Он отвечает за работу с включаемыми областями на страницах.

### Методы

- **getFilePath**: Метод для получения пути к файлу с учетом стартового пути. Если файл не найден, возвращает false.
- **includeSectionArea**: Метод для подключения секционных файлов на основе переданного префикса файла и текущего пути.
## setting.php

Путь: lib/io/setting.php


### Классы

- **Setting**: Класс, относящийся к пространству имён SIMAI\Main\IO. Он отвечает за сохранение и получение настроек из файлов.

### Методы

- **saveToFile**: Метод для сохранения массива в файл в виде кода PHP.
- **getFromFile**: Метод для получения массива из файла. Он загружает файл и преобразует его содержимое в массив.

## subsite

Путь: lib/subsite

Папка содержит файлы для работы с подсайтами. Включает следующие файлы:

- coordinate.php: Файл для работы с координатами подсайтов.
- tree.php: Файл для работы с деревом подсайтов.
## tree.php

Путь: lib/subsite/tree.php


### Классы

- **Tree**: Класс, относящийся к пространству имён SIMAI\Main\Subsite. Он отвечает за работу с деревом подсайтов.

### Методы

- **Get**: Метод для получения информации о подсайте на основе его идентификатора. Выполняет запросы к инфоблоку и highload-блокам для извлечения данных о подсайте.

## scripts

Путь: scripts

Папка содержит скрипты для автоматизации различных процессов. Включает следующий файл:

- create_site.php: Скрипт для автоматического создания сайта.
## create_site.php

Путь: scripts/create_site.php


### Скрипт для автоматического создания сайта (create_site.php)

- Скрипт загружает необходимые модули: инфоблоки и highload-блоки Bitrix.
- Использует highload-блок для управления статусами заданий.
- Обрабатывает данные и изменяет статус задания на "в работе", если оно не находится в этом статусе.

# Описание модуля simai.mscore

## Назначение модуля

Модуль `simai.mscore` предназначен для управления различными аспектами веб-приложения на базе системы 1С-Битрикс. Он включает функциональность для работы с инфоблоками, highload-блоками, подсайтами и файлами, а также предоставляет различные автоматизированные скрипты для управления сайтом и его настройками.

## Структура модуля

Модуль структурирован в несколько основных папок:
- **block** — содержит логику для редактирования элементов блоков.
- **config** — файлы конфигураций, включая конфигурации для сайта.
- **configuration** — конфигурации для инфоблоков и передачи данных.
- **disk** — управление файлами и работой с дисковым пространством.
- **fileman** — управление свойствами файлов и страниц.
- **highload** — работа с highload-блоками, включая поиск.
- **io** — ввод-вывод данных, включаемые области и работа с настройками.
- **subsite** — функционал для управления подсайтами и их параметрами.
- **scripts** — автоматизированные скрипты для создания сайтов.

## Основные функциональные возможности

1. **Управление инфоблоками**: 
   - Классы и методы, которые обеспечивают работу с конфигурацией инфоблоков, в том числе получение и изменение их параметров.

2. **Работа с файлами**: 
   - Модуль включает классы для управления файлами, их свойствами и работы с дисковым пространством.

3. **Highload-блоки**: 
   - Классы для работы с highload-блоками 1С-Битрикс, включая поиск и индексацию данных.

4. **Подсайты**: 
   - Управление настройками подсайтов, включая координаты и дерево подсайтов, их параметры и идентификаторы.

5. **Скрипты автоматизации**: 
   - Скрипты для автоматического создания сайтов, управления статусами и выполнения задач в фоне.

## Используемые классы

Модуль включает следующие ключевые классы:
- **Edit** — редактирование элементов блоков.
- **Site** — работа с конфигурациями сайтов.
- **Iblock** — управление конфигурацией инфоблоков.
- **Disk** — управление файлами в highload-блоках.
- **Property** — управление пользовательскими свойствами файлов.
- **Search** — обработка поиска в highload-блоках.
- **Coordinate** и **Tree** — управление параметрами подсайтов.
- **IncludeArea** — работа с включаемыми областями.
- **Setting** — сохранение и получение настроек.

## Главные функции

1. **Получение и изменение параметров инфоблоков**.
2. **Управление файлами и их свойствами через disk и fileman**.
3. **Обработка данных highload-блоков, их поиск и индексация**.
4. **Управление параметрами подсайтов, настройками координат и дерева**.
5. **Автоматизация задач с помощью скриптов для создания сайтов и управления ими**.

## Особенности и преимущества модуля

Модуль `simai.mscore` предоставляет гибкий и мощный инструмент для управления контентом и конфигурациями в системе 1С-Битрикс. Он включает комплексный набор классов и методов для работы с различными аспектами веб-приложений, включая управление файлами, инфоблоками, highload-блоками и настройками подсайтов. Благодаря встроенным скриптам, модуль упрощает автоматизацию задач и управления сайтами, что делает его важным компонентом для веб-разработки.
