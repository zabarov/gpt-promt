# Создание полной и подробной документации для модуля

## Описание задачи

Необходимо создать **полную и подробную документацию** по модулю из предоставленного архива в формате **Markdown** на **русском языке**. Документация должна повторять структуру файлов модуля и включать детальные описания каждого файла и папки.

## Общие инструкции

- **Запрещается любая импровизация или выполнение действий, не описанных в этом промте.** Все шаги должны строго следовать инструкциям, данным ниже. Если шаг не описан или неясен, остановитесь и запросите уточнение у пользователя.

- **Не добавляйте и не интерпретируйте информацию самостоятельно.** Выполняйте только те действия, которые явно описаны.

- Каждый этап выполнения необходимо завершить, перед тем как перейти к следующему, и **всегда** дожидаться подтверждения пользователя перед началом следующего шага.

## Требования к процессу

### 1.  Последовательность и точность
- **Используй для генерации ответов минимальную температуру** (0 или близкую к 0), чтобы обеспечить максимальную последовательность в выводе и избежать различий при повторном использовании промта.
- При каждом шаге строго следуй заданной структуре и формулировкам, чтобы вывод был предсказуемым и повторяемым.
- **Тщательно соблюдай все шаги указанные в промте**!

### 2. Разбиение работы
- Разбей всю работу на логические этапы, которые можно выполнять по отдельности.

### 3. Журналирование

- Веди журнал обработки, фиксируя ключевые этапы выполнения и возможные ошибки на **русском языке**.
- Выводи всю необходимую информацию о полученных данных в чат.

### 4. Непрерывность и продолжение работы

- Если нет указания запрашивать ожидания пользователя - автоматически переходи к следующему шагу.
- Если ожидаешь подверждения от пользователя, напиши ему, что он может отправить любой символ для продолжения работы.
- Если пользователь отправляет любой символ, это является сигналом для модели перейти к следующему этапу или продолжить текущий процесс.

### 5. Приодическое обновление времени хранения распакованных файлов

- После распаковки файлов, настрой процесс на периодическое обновление метаданных (время последнего доступа или модификации) для всех распакованных файлов и папок а также созданных тобой файлов `progress.json` и `doc_{archive_name}.md`.
- Выполняй обновление метаданных каждые 10-15 минут, чтобы файлы оставались «свежими» в системе и не удалялись. Продолжай это обновление до завершения работы с файлами.

### 6. Проверка и восстановление файлов

- Если в процессе работы обнаружится, что распакованные файлы недоступны или отсутствуют:
  - Сообщи пользователю: "Распакованные файлы не обнаружены. Пожалуйста, загрузите архив снова, чтобы продолжить работу."
  - Дождись загрузки архива от пользователя.
  - После загрузки распакуй архив, сохраняя оригинальную структуру папок и файлов.
  - Убедись, что пути в файле `progress.json` совпадают с распакованными файлами.
  - Продолжи обработку с того места, где остановился, используя `progress.json` для определения текущего статуса выполнения.

### 7. Обработка непредвиденных ошибок:

- Если в процессе обработки возникнет проблема (например, файл не удается прочитать или обработать):
- Выведите сообщение об ошибке в чат с указанием проблемы.
- Дождитесь подтверждения от пользователя перед попыткой обработки следующего элемента.
- Если пользователь подтвердит, продолжите обработку следующего элемента, пропустив проблемный.
- Запишите информацию о проблеме в `progress.json`, чтобы вернуться к ней позже, если необходимо. Убедитесь, что краткое описание проблемы включено также в конечную документацию, чтобы указать на возможные затруднения при работе с этим модулем.

## Этапы выполнения работ


### 1. Получение архива и его распаковка

#### 1.1. Приём архива

- Принимай архив с файлами модуля в формате `.zip`.
#### 1.2. Разархивирование

- Разархивируй содержимое архива, сохраняя структуру папок.


### 2. Очистка файлов от мусора

#### 2.1. Удаление ненужных файлов и папок

- Рекурсивно пройди по всем распакованным папкам и файлам.
- Удали папки и файлы названия которых:
	- Начинаются с нижнего подчёркивания `_`.
	- Называются `.DS_Store`.
	- Называются `lang`.
- Перед удалением проверь есть ли в этой папки другие папки и файлы.
- Перед удалением любой папки сначала нужно удалить все вложенные в нее файлы.


### 3. Подготовка файла прогресса (`progress.json`)

- **Создание и инициализация `progress.json`:**. Файл должен создан в папке `/temp`.
- **JSON Schema для `progress.json`:**

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "properties": {
        "name": {
            "type": "string",
            "description": "Название папки или файла"
        },
        "absolute_path": {
            "type": "string",
            "description": "Абсолютный путь к папке или файлу"
        },
        "relative_path": {
            "type": "string",
            "description": "Относительный путь к папке или файлу от корня модуля"
        },
        "type": {
            "type": "string",
            "enum": ["folder", "file"],
            "description": "Тип объекта: папка или файл"
        },
        "processed": {
            "type": "boolean",
            "description": "Отметка о том, обработан ли файл или папка"
        },
        "children": {
            "type": "array",
            "description": "Вложенные папки и файлы",
            "items": { "$ref": "#" }
        }
    },
    "required": ["name", "absolute_path", "relative_path", "type", "processed"],
    "additionalProperties": false
}
```

- **Заполнение `progress.json`:**
- Проходи по списку файлов и папок, отбирая только те, которые имеют расширения `.php`, `.js` и `.css`, за исключением папок с названием `lang` и всех папок и файлов, хранящихся в них.
- Для каждой подходящей папки и файла создавай соответствующий объект в `progress.json` согласно JSON Schema. Указывай два пути:
	- `absolute_path`: абсолютный путь к файлу или папке, который будет использоваться для операций чтения файлов.
	-  `relative_path`: относительный путь к файлу или папке от корня модуля, начиная с `/` (например, `/simai.mscore/admin/index.php`), который будет использоваться в документации.
- Для отображения иерархической структуры папок и файлов используй `children`.


### 4. Подготовка промежуточного файла документации (`doc_{archive_name}.md`)

- **Создай временный файл документации** `doc_{archive_name}.md` с заголовком документации в папке `/temp`.
- **Предоставь ссылку на файлы:**
	- [Ссылка на `doc_{archive_name}.md`](#)
	- [Ссылка на `progress.json`](#)
- **Запроси подтверждение от пользователя перед переходом к следующему шагу.**

### 5. Анализ структуры файлов

Выполняй поэтапно, каждый шаг должен быть завершен перед переходом к следующему.

#### 5.1. Определение корневой директории

- Определи корневую директорию модуля. Если внутри распакованной директории присутствует папка с названием аналогичным имени архива (например, `simai.mscore/`), считай её корневой папкой. Игнорируй все файлы и папки на том же уровне, что и корневая папка (например, `doc_simai.mscore.md` и `progress.json`).
- Корневая папка должна входить в дерево файлов.
- Файлы `progress.json` и `doc_{archive_name}.md` не должны входить в дерево файлов.

#### 5.2. Создание функции для генерации файлового дерева

1. **Добавьте корневую папку в начало дерева:**
   - Начните с добавления строки, которая содержит только название корневой папки и символ `/` (например, `"simai.mscore/"`).

2. **Рекурсивный обход вложенных папок и файлов:**
   - После явного добавления корневой папки, выполните рекурсивный обход файлов и папок внутри этой корневой папки.
   - Исключите из дерева файлы `doc_{archive_name}.md` и `progress.json`.

3. **Добавление символов соединения:**
   - Для каждого файла или папки определите, является ли элемент последним в списке. Если да, используйте символ `└──`; если нет, используйте `├──`.
   - Для папок добавляйте символ `/` в конце, чтобы они отличались от файлов.

4. **Добавление отступов:**
   - Если элемент вложен в другую папку, добавьте префикс отступа, чтобы отразить его уровень вложенности. Используйте вертикальную линию `"│   "` для обозначения вложенности, когда элемент не является последним. Для последнего элемента используйте четыре пробела `"    "` вместо вертикальной линии.
   - При обработке содержимого вложенной папки добавляйте отступы в зависимости от того, является ли текущая папка или файл последним в своем каталоге.

5. **Рекурсивный обход:**
   - Если элемент является папкой, вызовите функцию для обработки его содержимого, передав правильный префикс для отступов.
   - В каждом вызове определите, является ли текущий элемент последним, чтобы правильно использовать символы соединения и отступы.

6. **Сборка дерева:**
   - Соберите дерево файлов и папок в виде строк и объедините их в единый текст с использованием символов соединения и отступов.
   - Заключите готовое дерево в блок кода (используйте тройные обратные кавычки и укажите `markdown`), чтобы оно правильно отображалось в документе.
   - Дерево должно начинаться с корневой папки, добавленной на первом шаге.

7. **Добавление в документацию:**
   - Перезапишите файл документации `doc_{archive_name}.md`, чтобы он содержал только заголовок “Документация модуля” и новый раздел “Структура файлов и папок”.
   - Добавьте дерево файлов в раздел “Структура файлов и папок” в документе.

8. **Пример корректного дерева:**
```markdown
   simai.mscore/
   ├── handler/
   │   └── typeschool.php
   ├── install/
   │   ├── index.php
   │   └── version.php
   ├── include.php
   ├── admin/
   │   ├── on_work.php
   │   ├── iblock.section.edit.php
   │   ├── on_reject.php
   ...
```



### 6. Обработка файлов и папок

#### 6.1. Прочитай файл `progress.json`

- Найди первый необработанный объект, исключая корневую папку модуля.
- Обрабатывай только вложенные папки и файлы.
- Выведи в чат, какой объект ты будешь обрабатывать, и предоставь следующую информацию:
    - Название
    - `relative_path`: путь относительно корня
    - Тип (папка или файл)

#### 6.2. Для папки:

- При обработке папок указывай путь относительно корня модуля.
- Определи назначение папки и перечисли все файлы внутри неё.
- Добавь в документ:
  - Название папки.
  - Путь **относительно корня модуля** (например, /simai.mscore/install).
  - Список вложенных файлов.
- Выведи информацию о папке в чат.

#### 6.3. Для файла:

**Шаг 1. Собери общую информацию о файле:**

- Название файла, **путь относительно корня модуля** (например, `/simai.mscore/install/index.php`) и тип файла.
- Выполни поиск строки `namespace` в верхней части файла, чтобы определить наличие пространства имён. Если не обнаружено, явно укажи это.
- Определи назначение файла и кратко опиши его роль.
- **Выведи в чат:** Название, путь, тип файла, наличие или отсутствие пространства имён, и краткое описание назначения файла.
- **Добавь инструкцию:** Напиши: "Пожалуйста, подтвердите, чтобы обработать следующую часть (отправьте любой символ для продолжения)."

**Шаг 2. Подробно опиши логику работы файла:**

- Проведи **глубокий анализ** логики работы файла, **используя знания об API 1С-Битрикс**.
- Описывай основные блоки кода, их назначение, и как они взаимодействуют, опираясь на особенности работы с модулями в 1С-Битрикс.
- Если в коде используются встроенные классы, функции и методы 1С-Битрикс, объясни, что они делают и как взаимодействуют с остальными частями системы.
- Если присутствуют циклы и условия, объясни их роль и влияние на общий процесс.
- **Выведи в чат:** Результаты анализа логики работы файла, учитывая использование API 1С-Битрикс.
- **Добавь инструкцию:** Напиши: "Пожалуйста, подтвердите, чтобы обработать следующую часть (отправьте любой символ для продолжения)."

**Шаг 3. Обработай константы:**

- Проверь наличие констант в файле, используя поиск по ключевым словам `define` и `const`. Убедись, что фиксируешь не только название, но и значение каждой константы.
- **Если константы найдены:** 
  - Перечисли все константы, укажи их название и значение.
  - Внеси каждую константу в документ с подробным описанием.
- **Если константы отсутствуют:** Сообщи об этом в чате.
- **Добавь инструкцию:** Напиши: "Пожалуйста, подтвердите, чтобы обработать следующую часть (отправьте любой символ для продолжения)."

**Шаг 4. Обработай классы:**

- Проверь, есть ли в файле классы.
- **Если классы найдены:**
  - Для каждого класса:
    - Определи его роль в модуле и опиши кратко, **используя знания об API 1С-Битрикс**.
    - Перечисли все его методы в формате `Class::Method($param1, $param2)`, используя полные сигнатуры методов.
    - Для каждого метода опиши его логику и назначение, включая возможные взаимодействия с другими частями кода.
    - **Обрати внимание на наличие модификаторов доступа** (public, private, protected) для методов и укажи их в описании. Объясни, как они влияют на доступ к методам внутри и за пределами класса.
    - **Выведи в чат:** Название класса, его роль, список методов с описанием, и модификаторы доступа каждого метода.
    - **Добавь инструкцию:** Напиши: "Пожалуйста, подтвердите, чтобы обработать следующий класс (отправьте любой символ для продолжения)."
- **Если классы отсутствуют:** Сообщи об этом в чате.
- **Добавь инструкцию:** Напиши: "Пожалуйста, подтвердите, чтобы обработать следующую часть (отправьте любой символ для продолжения)."

**Шаг 5. Обработай функции вне класса:**

- Проверь, есть ли в файле функции вне класса.
- **Если функции вне класса найдены:** 
  - Перечисли их в формате `FunctionName($param1, $param2)`, **без привязки к имени класса**.
  - Опиши назначение и логику каждой функции, укажи параметры, которые они принимают, , **используя знания об API 1С-Битрикс**, что они возвращают, и взаимодействуют ли они с глобальными переменными или объектами.
- **Если функции вне класса отсутствуют:** Сообщи об этом в чате.
- **Добавь инструкцию:** Напиши: "Пожалуйста, подтвердите, чтобы обработать следующую часть (отправьте любой символ для продолжения)."

**Шаг 6. Подготовка для добавления в документ:**

- Собери всю информацию о файле, включая подробное описание назначения, константы, классы, методы и функции. **Не сокращай и не упускай детали:** Внеси всю информацию из предыдущих шагов в документ, включая их сигнатуры, назначения и логику работы. **Перепроверь все данные перед добавлением в документ**, чтобы убедиться, что ничего не упущено.
- **Выведи в чат:** Полную информацию, подготовленную для записи в документ.
- **Добавь инструкцию:** Напиши: "Пожалуйста, подтвердите, чтобы добавить в документ (отправьте любой символ для продолжения)."

#### 6.5. Установи `processed: true` для данного объекта в `progress.json`.

- Установите `processed: true` только для текущего объекта в `progress.json` после завершения его обработки и добавления информации в документ. Не изменяйте статус вложенных объектов.
- Если объект — папка, установите `processed: true` только для этой папки, не отмечая её содержимое.
- Пример: Если обрабатывается папка `lib`, установите `processed: true` только для этой папки, оставляя все вложенные файлы и папки необработанными.

#### 6.6. Выведи в чат количество обработанных объектов и оставшееся количество.

#### 6.7. После вывода статистики, предоставь в чат ссылки на обновленные файлы:

- [Ссылка на `doc_{archive_name}.md`](#)
- [Ссылка на `progress.json`](#)
- Дождись подтверждения от пользователя перед переходом к следующему шагу.

#### 6.8. Повторяй цикл обработки, пока не будут обработаны все объекты в `progress.json`.

### 7. Создание общего описания модуля

#### 7.1. Анализ информации:

- Прочитай все собранные данные о файлах, папках и функциональности модуля, уже записанные в документ.
- Выдели ключевые особенности и функциональные возможности модуля, такие как:
- Основное назначение модуля и решаемые задачи.
- Основные классы и их взаимодействие.
- Ключевые функции и их роль в работе модуля.
- Особенности и отличия от стандартной функциональности, если они есть.

#### 7.2. Подготовка черновика описания:

- Составь подробное общее описание модуля, включив в него:
- Назначение модуля: укажи его основную цель и задачи, которые он решает в системе.
- Основную структуру модуля: кратко упомяни, как организованы файлы и папки, не повторяя их список.
- Основные функциональные возможности: перечисли и опиши основные задачи, которые реализует модуль.
- Используемые классы: упомяни основные классы, их назначение и как они взаимодействуют друг с другом.
- Главные функции: перечисли ключевые функции и кратко укажи их роль.
- Особенности и преимущества модуля: если модуль имеет уникальные особенности или отличается от стандартной реализации, опиши их.
- Добавь все описания в один связный раздел "Описание модуля".

#### 7.3. Редактирование и корректировка:

- Проверь черновик описания на предмет полноты и связности.
- Добавь или уточни детали, чтобы создать полное представление о функциональности модуля.

#### 7.4. Запись в документ:

- После завершения редактирования добавь раздел "Описание модуля" в начало документа `documentation_temp.md`.
- Сообщи о завершении записи в чат и предоставь обновленную ссылку на документ.


### 8. Создание перекрестных ссылок

- Выполняй поэтапно, каждый шаг должен быть завершен перед переходом к следующему.
#### 8.1. Анализ структуры:

- Просмотри структуру документации и определи все упомянутые файлы, разделы и их ссылки.
- Собери список разделов, которые необходимо связать друг с другом.

#### 8.2. Сбор информации о ссылках:

- Пройдись по документу и найди все места, где упоминаются другие разделы или файлы.
- Для каждого упоминания отметь, где должна быть вставлена перекрестная ссылка.

#### 8.3. Создание ссылок (поэтапно):

- **8.3.1.** Обработай первый раздел:
	- Вставь перекрестные ссылки на все связанные разделы и файлы, используя формат Markdown.
	- Сообщи о завершении обработки этого раздела.

- **8.3.2.** Переходи к следующему разделу:
	- Повтори процесс вставки ссылок.
	- Повторяй эти шаги, пока не будут обработаны все разделы.

#### 8.4. Проверка и корректировка:

- Просмотри документ, чтобы убедиться, что все ссылки работают корректно.
- Если обнаружишь проблемы (например, недостающие или некорректные ссылки), исправь их.
- Сообщи пользователю, что проверка завершена, и предоставь обновленную ссылку на документ.

#### 8.5. Финальная запись в файл:

- После завершения всех шагов запиши обновленный документ с перекрестными ссылками в файл `doc_{archive_name}.md`.
- Сообщи о завершении создания перекрестных ссылок и предоставь финальную ссылку на документ.

### 8.6. Итоговая проверка перед завершением работы

- Перечитай подготовленную документацию, убедись, что в ней отражены все выявленные аспекты модуля (константы, функции, классы, методы, пространство имён). Проверь также согласованность и связность описаний, убедись, что вся информация представлена логично и последовательно.
- Если обнаружишь упущенные детали или недостаточную проработку какого-либо элемента, вернись к соответствующему шагу и дополни документ.
- **Добавь инструкцию:** Напиши: "Пожалуйста, подтвердите, что все детали были отражены и документ готов к завершению работы (отправьте любой символ для завершения)."

### 9. Завершение работы

- Установи статус `processed: true` для всех объектов в `progress.json`.
- Предоставьте ссылки на обновленный документ и `progress.json`.