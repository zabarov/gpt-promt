# Создание полной и подробной документации для модуля

## Описание задачи

Необходимо создать **полную и подробную документацию** по модулю из предоставленного архива в формате **Markdown** на **русском языке**. 

## Термины и определения

- **Основной файл документации** — файл, который содержит полное описание модуля, его структуры, классов, методов и функций. Этот файл объединяет все данные о модуле.
- **Временный файл документации** — временный файл, создаваемый для каждого отдельного файла модуля. В него записываются описания классов, методов, констант или функций для конкретного файла.
- **Основной файл прогресса** — файл `progress.json`, в котором фиксируется информация о всех папках и файлах модуля.
- **Временный файл прогресса** — временный файл для фиксации прогресса обработки элементов внутри конкретного файла.
- **Текущий файл** — объект `progress.json` типа `файл`, который в данный момент обрабатывается. 
- **Константа** — переменная, значение которой не изменяется. Описывается её имя, значение и назначение.
- **Класс** — основная структура в объектно-ориентированном программировании, объединяющая свойства и методы.
- **Метод** — функция, принадлежащая классу, описывающая логику взаимодействия с классом.
- **Функция** — структура, выполняющая задачу и не привязанная к классу.
- **Модуль** — самостоятельная единица кода, реализующая определённую функциональность и подключаемая к системе.

## Требования к процессу:

**Точность действий**
- Все действия должны **строго следовать инструкциям**, данным ниже. Если шаг не описан или неясен, остановитесь и запросите уточнение у пользователя.

**Циклы их вложенность**
- Данный промт содержить 2 (два) цикла:
    - В рамках первого цикла обрабатываются элементы файла прогресса `progress.json`
    - В рамках второго (который вложен в первый) обрабатываются отдельные элементы **текущего файла** которые отражены в файле `file_name.json`.
- **Все действия в циклах должны отрабатываться шаг за шагом отдельно без объединения в один блок работ**    

**Разбиение работы**
- Разбей всю работу на логические блоки работы, которые можно выполнять по отдельности.
- Циклы должны обрабтываться последовательно. **Запрещается выполнять цикл за один блок**.
- Продолжительность обработки одного блока работы не должна превышать 30 секунд.

**Режим проверки**
- После выполнения каждого шага проверь насколько он соотвествует заданному промту. Если не соотвествует - переделай так чтобы соотвесствовало.

**Журналирование**
- Веди журнал обработки, фиксируя ключевые этапы выполнения и возможные ошибки на **русском языке**.
- Выводи всю необходимую информацию о полученных данных в чат.

**Продолжение работы**
- Если нет указания запрашивать ожидания пользователя - автоматически переходи к следующему шагу.
- Если пользователь отправляет любой символ, это является сигналом для модели перейти к следующему этапу или продолжить текущий процесс.

**Проверка и восстановление файлов**
Если в процессе работы обнаружится, что распакованные файлы недоступны или отсутствуют:
- Сообщи пользователю: "Распакованные файлы не обнаружены. Пожалуйста, загрузите архив снова, чтобы продолжить работу."
- Дождись загрузки архива от пользователя.
- После загрузки распакуй архив, сохраняя оригинальную структуру папок и файлов.
- Убедись, что пути в файле `progress.json` совпадают с распакованными файлами.
- Продолжи обработку с того места, где остановился, используя `progress.json` для определения текущего статуса выполнения.


## Этапы выполнения работ

### Этап 1. Распаковка архива

- Разархивируй содержимое архива, сохраняя структуру папок.

### Этап 3. Подготовка файла прогресса

3.1. Создай и инициализируй **основной файл прогресса** `progress.json`. 
- JSON Schema для `progress.json`:
```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "properties": {
        "name": {
            "type": "string",
            "description": "Название папки или файла"
        },
        "absolute_path": {
            "type": "string",
            "description": "Абсолютный путь к папке или файлу"
        },
        "relative_path": {
            "type": "string",
            "description": "Относительный путь к папке или файлу от корня модуля"
        },
        "type": {
            "type": "string",
            "enum": ["folder", "file"],
            "description": "Тип объекта: папка или файл"
        },
        "processed": {
            "type": "boolean",
            "description": "Отметка о том, обработан ли файл или папка"
        },
        "children": {
            "type": "array",
            "description": "Вложенные папки и файлы",
            "items": { "$ref": "#" }
        }
    },
    "required": ["name", "absolute_path", "relative_path", "type", "processed"],
    "additionalProperties": false
}
```
**3.2. Заполнение файла прогресса:**
- Начни с корневой папки модуля, но если она имеет во вложении папку с таким же названием **не добавляй её как элемент в структуру**.
- Построй структуру, начиная с содержимого корневой папки (вложенные папки и файлы).
- **Рекурсивно** проходи по всем вложенным папкам:
  - Для каждой папки проходи по её содержимому и заполняй вложенные файлы и папки.
  - Для вложенных элементов (файлы или папки) также заполняй поля `absolute_path` и `relative_path`.
- Обрабатывай **все вложенные директории** до самого глубокого уровня вложенности.
- Для каждой подходящей папки и файла создавай соответствующий объект в `progress.json` согласно JSON Schema.
- Для отображения иерархической структуры папок и файлов используй children.

**ВАЖНО! Пропускай следующие файлы и папки. Не добавляй их в структуру:**
- Все файлы названия которых начинаются с нижнего подчёркивания (_).
- Все папки названия которых начинаются с нижнего подчёркивания (_) включая все вложенные файлы и папки внутри этих директорий.
- Все файлы с название `.DS_Store`.
- Все папки с названием `lang`, включая все вложенные файлы и папки внутри этих директорий.

3.3. Проверь корректность заполнения файла прогресса `progress.json`.
- После корректного заполнения файла прогресса `progress.json` переходи к 4 этапу. 

### Этап 4. Сортировка папок и файлов в `progress.json`

**Произведи сортировку файлов и папок** в `progress.json` согласно следующим правилам:

1. **Сортировка файлов и папок должна выполняться отдельно**:
- Сначала необходимо отсортировать **все файлы** в текущей директории в **алфавитном порядке**.
- После сортировки файлов необходимо отсортировать **все папки** в этой же директории также в **алфавитном порядке**.
- **Важно**: Файлы должны быть указаны **перед** папками на каждом уровне вложенности.
- Пример:
    ```
    ├── a.php
    ├── b.php
    ├── c.js
    ├── config/
    └── scripts/
    ```

2. **Применяйте этот принцип рекурсивно**:
- Для каждой папки повторите процесс: сначала сортируйте файлы, затем папки на каждом уровне.
- Этот порядок должен сохраняться для всех подкаталогов, начиная с корневой директории.

3. **Правила сортировки для каждого уровня**:
- На каждом уровне сначала идут файлы по алфавиту, затем папки.

4. **Проверь структуру после сортировки:**
- **Обязательно выведи в чат** текущую структуру после сортировки, чтобы убедиться в правильности порядка элементов.
- Пример корректной сортировки:
```
simai.mscore/
├── include.php
├── install/
│   ├── index.php
│   └── version.php
├── lib/
└── scripts/
```

5. **Запиши файл прогресса только после сортировки**:
- Убедись, что структура отсортирована корректно на всех уровнях вложенности.
- Только после подтверждения сортировки переходи к обновлению файла прогресса  `progress.json`.

### Этап 5. Создание структуры файлов

5.1. Создай **основной файл документации** `doc_{archive_name}.md` с заголовком документации.

5.2. Определи корневую директорию модуля:
- Если распакованная директория содержит папку с названием, совпадающим с именем архива (например, `simai.mscore/`), считай её корневой.
- Игнорируй файлы и папки на одном уровне с корневой папкой (например, `doc_simai.mscore.md` и `progress.json`).

5.3. Прочитай **основной файл прогресса** `progress.json`, используй поле `children` для рекурсивного обхода вложенных элементов.

5.4. Построй дерево:
- Начни с корневой папки и добавь её в дерево (например, `"simai.mscore/"`) **без символов перед ней**.
- Для файлов и папок на каждом уровне используй следующие символы:
  - Символы `└──` для последних элементов.
  - Символы `├──` для всех остальных элементов.
  - Используй `│   ` для отступов у вложенных файлов и папок, если они не последний элемент.
  - Добавляй символ `/` для папок.

5.5. Для каждого уровня вложенности добавь отступы:
- Используй символы `"│   "` для элементов, которые не являются последними на уровне.
- Для последнего элемента на уровне используй `"    "` (четыре пробела) перед символом `└──`.
- Корневая папка (например, `"simai.mscore/"`) должна отображаться **без символов**.

5.6. Собери дерево файлов и папок, используя данные из `progress.json`:
- Начни с корневой папки и добавь её в дерево (например, `"simai.mscore/"`) **без символов перед ней**.
- Для файлов и папок на каждом уровне используй следующие символы:
  - Символы `└──` для последних элементов.
  - Символы `├──` для всех остальных элементов.
  - Используй `│   ` для отступов у вложенных файлов и папок, если они не последний элемент.
  - Добавляй символ `/` для папок.

Пример корректного дерева:
```markdown
simai.mscore/
├── include.php
├── install/
│   ├── index.php
│   └── version.php
└── lib/
    ├── config/
    └── highload/
```
- Убедись, что в основной файл документации дерево добавлено как блок кода.

5.7. **Выведи в чат ссылки на файлы:**
- [Ссылка на `doc_{archive_name}.md`](#)
- [Ссылка на `progress.json`](#)


### Этап 6. Обработка файлов и папок
Шаги обработки файлов и папок:

6.1. Прочитай файл `progress.json`

6.2. Найди первый необработанный объект, исключая корневую папку модуля.

6.3. **Выведи в чат**, какой объект ты будешь обрабатывать, и предоставь следующую информацию:
- Название
- `relative_path`: путь относительно корня
- Тип (папка или файл)

6.4. **Для папки**:
- Определи назначение папки и перечисли все файлы внутри неё.
- ВАЖНО! Перед обработкой файлов в папке, обязательно **выведи в чат и добавь в файл `doc_{archive_name}.md`**:
  - Название папки.
  - Путь `relative_path` относительно корня.
  - Список вложенных файлов.
- После обработки информации о папке, обязательно добавляй её в **основной файл документации** `doc_{archive_name}.md`.
- Только после этого переходи к обработке файлов внутри этой папки.

6.5. **Для файла:**
- **ВАЖНО!** Далее этот файл будет называться **текущий файл**.
- Убедись что перед обработкой файла информация о вышестоящей папке была уже обработана и добавлена в файл `doc_{archive_name}.md`

6.5.1. Создай **временный файл прогресса для файла** `file_name.json`, чтобы отслеживать прогресс обработки элементов файла.
- Создайте JSON-файл `file_name.json`, где `file_name` — это имя обрабатываемого файла без расширения.
- Этот файл будет использоваться для фиксации обработки каждого элемента файла (константы, классы, методы, функции).
- JSON Schema для временного файла прогресса:
```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "properties": {
        "name": {
            "type": "string",
            "description": "Название константы, класса, метода или функции"
        },
        "type": {
            "type": "string",
            "enum": ["constant", "class", "method", "function"],
            "description": "Тип объекта: константа, класс, метод, функция"
        },
        "processed": {
            "type": "boolean",
            "description": "Отметка о том, обработана ли константа, класс, метод, функция"
        },
        "children": {
            "type": "array",
            "description": "Вложенные методы",
            "items": { "$ref": "#" }
        }
    },
    "required": ["type", "processed"],
    "additionalProperties": false
}
```
6.5.2. После создания `file_name.json` **Внимательно** прочти содержимое **текущего файла**. 

6.5.3. После прочтения содержимого **текущего файла**, заполни `file_name.json`:
- Добавь **все константы, классы, методы и функции** найденные в текущем файле.
- **Методы добавляй только для класса который есть в этом файлев.** Методы из внешних классов добавлять не нужно
- Для отображения иерархической структуры папок и файлов используй children.
- Для **каждого элемента** установи `processed: false`.

6.5.4. После заполнения `file_name.json`, создай **временный файл документации для файла** `temp_file_name.md`, в который будет вноситься информация по **текущему файлу**.
- Создай временный Markdown-файл, используя заголовки **со второго уровня** (начиная с `##`).
- Добавь в фай `temp_file_name.md`:
  - Название файла в виде заголовка второго уровня: `## file_name`.
  - Путь `relative_path` относительно корня.
- Для секций внутри файла используй заголовки третьего уровня: `### Константы`, `### Классы`, `### Методы`.
- **Выведи сообщение в чат после успешного создания временного файла документации.**

6.5.5. Прочитай файл `file_name.json`. Найди первый необработанный объект (например, класс, метод, функция) и **выведи в чат** его название и тип.

6.5.6. **ВАЖНО! После прочтения содержимого текущего файла  Обработай элемент в зависимости от типа согласно инструкциям ниже**

**ДЛЯ КОНСТАНТЫ:**
- **Выведи в чат и добавь в файл `temp_file_name.md`:** 
    - Имя константы,
    - Значение константы,
    - **Подробное** описание константы.

**ДЛЯ КЛАССА:**
- Проведи **глубокий** анализ класса, **используя знания об API 1С-Битрикс**. 
- **Выведи в чат и добавь в файл `temp_file_name.md`:** 
    - Имя класса,
    - Пространство имен класса,
    - **Подробное** описание константы на основе анализа.

**ДЛЯ МЕТОДА:**
- Проведи **глубокий** анализ метода. 
- **Выведи в чат и добавь в файл `temp_file_name.md`:** 
    - Вызов метода в формате `Class::Method($param1, $param2)`, используя полные сигнатуры методов.
    - Логику и назначение, включая возможные взаимодействия с другими частями кода.
    - **Обрати внимание на наличие модификаторов доступа** (public, private, protected) для методов и укажи их в описании. Объясни, как они влияют на доступ к методам внутри и за пределами класса.

**ДЛЯ ФУНКЦИИ:**
- Проведи **глубокий** анализ метода. 
- **Выведи в чат и добавь в файл `temp_file_name.md`:** 
    - Вызов функции в формате `FunctionName($param1, $param2)`, **без привязки к имени класса**.
    - Логику и назначение, включая возможные взаимодействия с другими частями кода.
    - Опиши назначение и логику функции, укажи параметры, которые они принимают, , **используя знания об API 1С-Битрикс**, что они возвращают, и взаимодействуют ли они с глобальными переменными или объектами.

6.5.7. После обрабтки элемента, установи `processed: true` для данного объекта в `file_name.json`.
- Установите `processed: true` только для текущего объекта в `file_name.json` после завершения его обработки. Не изменяйте статус вложенных объектов.
- Если объект — **класс**, установите `processed: true` только для этого класса, не отмечая его содержимое.

6.5.8. После установки `processed: true` для данного объекта в `file_name.json`, **Выведи в чат ссылки на файлы:**
- Временный файл документации файла `temp_{file_name}.md`.
- Файл прогресса файла `file_name.json`.

6.5.9. **ВАЖНО!** Повторяй **цикл обработки текущего файла**, пока не будут обработаны все объекты в `file_name.json`. 
- **Если есть объекты с `processed: false` вернись на шаг 6.5.5.**
- После **завершения обработки всех элементов** (константы, классы, методы, функции) в `file_name.json` - перейди к шагу 6.5.10.

6.5.10. После **завершения обработки всех элементов** в `file_name.json`, проведи анализ содержимого файла `temp_{file_name}.md`
Когда все элементы обработаны и файл `temp_{file_name}.md` заполнен:
- Проведи анализ содержимого **текущего файла**, чтобы подготовить общее описание **текущего файла** и его логики работы.
- Это описание должно включать:
    - Общее назначение файла и его роль в системе.
    - Краткий обзор ключевых классов и функций, представленных в файле.
    - Описание взаимодействия классов и функций, если это уместно.
    - Основные задачи, которые решает файл, и его значимость в модуле.
- Добавь это описание **в начало файла** `temp_{file_name}.md`.

**6.5.11. После завершения обработки всех элементов файла, проведи анализ содержимого файла** temp_{file_name}.md
- Не забудь обязательно провести анализ файла и добавить общее описание файла.
- После этого проверь, что файл корректно обработан и подготовлен для добавления в основной документ.
- **ВАЖНО! Перед переходом к следующему этапу обязательно выполняй шаг 6.5.12.**

6.5.12. После завершения обработки всех элементов файла добавь содержимое временного файла во основной документ.
- ВАЖНО! Обязательно проверь, что добавление в основной документ произошло успешно. Если файл не добавлен — повтори шаг.
- Проверь содержимое: открой основной файл и убедись, что новый блок действительно присутствует.
- **Перед переходом к следующему шагу убедись, что шаг 6.5.12 полностью выполнен.**

6.5.13. **Удаление временных файлов:**
- После успешного копирования данных, удали **временный файл документации для файла** `temp_file_name.md`.
- Также удали **временный файл прогресса для файла** `file_name.json`.
- Проверь, что временные файлы были удалены корректно.

6.5.14. После завершения обработки всех элементов файла, подготовки описания и копирования данных в основной файл документации переходи к шагу 5.6.
- Обновите основной файл прогресса `progress.json`, установив флаг `processed: true` для текущего файла.

6.6. **Выведи в чат ссылки на файлы:**
- Файл документации `doc_{archive_name}.md`.
- Файл прогресса `progress.json`.

6.7. **Установи `processed: true` для данного объекта в `progress.json`.**
- Установите `processed: true` только для текущего объекта в `progress.json` после завершения его обработки и добавления информации в документ. Не изменяйте статус вложенных объектов.
- Если объект — папка, установите `processed: true` только для этой папки, не отмечая её содержимое.
- Пример: Если обрабатывается папка `lib`, установите `processed: true` только для этой папки, оставляя все вложенные файлы и папки необработанными.

6.8. **Выведи в чат количество обработанных объектов и оставшееся количество.**

6.8. **Повторяй цикл обработки папок и файлов, пока не будут обработаны все объекты в `progress.json`.**
- Если есть вложенные необработанные объекты обрабатывай их, пока все объекты не будут обработаны. Для этого вернись к шагу 5.1. 

6.9. **После завершения обработки всех файлов**
- **После завершения всех объектов этапа 5 автоматически переходи к этапу 6 — созданию общего описания модуля.**

### Этап 7. Создание общего описания модуля

7.1. **Анализ информации:**

- Прочитай все собранные данные о файлах, папках и функциональности модуля, уже записанные в документ.
- Выдели ключевые особенности и функциональные возможности модуля, такие как:
- Основное назначение модуля и решаемые задачи.
- Основные классы и их взаимодействие.
- Ключевые функции и их роль в работе модуля.
- Особенности и отличия от стандартной функциональности, если они есть.

7.2. **Подготовка черновика описания:**

- Составь подробное общее описание модуля, включив в него:
- Назначение модуля: укажи его основную цель и задачи, которые он решает в системе.
- Основную структуру модуля: кратко упомяни, как организованы файлы и папки, не повторяя их список.
- Основные функциональные возможности: перечисли и опиши основные задачи, которые реализует модуль.
- Используемые классы: упомяни основные классы, их назначение и как они взаимодействуют друг с другом.
- Главные функции: перечисли ключевые функции и кратко укажи их роль.
- Особенности и преимущества модуля: если модуль имеет уникальные особенности или отличается от стандартной реализации, опиши их.
- Добавь все описания в один связный раздел "Описание модуля".

7.3. **Редактирование и корректировка:**

- Проверь черновик описания на предмет полноты и связности.
- Добавь или уточни детали, чтобы создать полное представление о функциональности модуля.

7.4. **Запись в документ:**

- После завершения редактирования добавь раздел "Описание модуля" **в начало** документа `doc_{archive_name}.md`.
- Сообщи о завершении записи в чат и предоставь обновленную ссылку на документ.
- Если обнаружишь проблемы (например, недостающие или некорректные ссылки), исправь их.
- Сообщи пользователю, что проверка завершена, и предоставь обновленную ссылку на документ.

7.5. **Предоставь ссылки на файлы:**
- Файл документации `doc_{archive_name}.md`.
- Файл прогресса `progress.json`.

### Этап 8. Создание перекрестных ссылок

- Выполняй поэтапно, каждый шаг должен быть завершен перед переходом к следующему.

8.1. Анализ структуры:
- Просмотри структуру документации и определи все упомянутые файлы, разделы и их ссылки.
- Собери список разделов, которые необходимо связать друг с другом.

8.2. Сбор информации о ссылках:
- Пройдись по документу и найди все места, где упоминаются другие разделы или файлы.
- Для каждого упоминания отметь, где должна быть вставлена перекрестная ссылка.

8.3. Создание ссылок (поэтапно):

8.3.1. Обработай первый раздел:
	- Вставь перекрестные ссылки на все связанные разделы и файлы, используя формат Markdown.
	- Сообщи о завершении обработки этого раздела.

8.3.2. Переходи к следующему разделу:
	- Повтори процесс вставки ссылок.
	- Повторяй эти шаги, пока не будут обработаны все разделы.
