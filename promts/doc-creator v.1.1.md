# Создание полной и подробной документации для модуля

## Описание задачи

Необходимо создать **полную и подробную документацию** по модулю из предоставленного архива в формате **Markdown** на **русском языке**. Документация должна повторять структуру файлов модуля и включать детальные описания каждого файла и папки.

## Требования к процессу

### 1. Точность действий
- Все шаги должны **строго следовать инструкциям**, данным ниже. Если шаг не описан или неясен, остановитесь и запросите уточнение у пользователя.

### 2. Разбиение работы
- Разбей всю работу на логические этапы, которые можно выполнять по отдельности.
- Продолжительность обработки одного этапа не должна превышать 30 секунд.

### 3. Подпроцессы
- Подпроцессы имеют в нумерации перед номером восклицательный знак. Например `!6.3.2.`. Это сигнал того, что такие этапы требуют отдельного выполнения, особого внимания и обработки.
- Подпроцессы нельзя объединять. Каждый подпроцесс нужно обработать отдельно, без параллельного выполнения других задач. Внутри подпроцесса можно разбивать работу на логические этапы, которые можно выполнять по отдельности. 
- Запуск “подпроцесса”: при обработке особого этапа выполнение всех остальных процессов приостанавливается. Необходимо выполнить только данный этап, вывести результат его выполнения в чат, и дождаться подтверждения пользователя для продолжения.
- **Добавляй в документацию только те элементы, которые были найдены.** Если элемент не обнаружен, не добавляй об этом информацию в документ.

### 4. Журналирование
- Веди журнал обработки, фиксируя ключевые этапы выполнения и возможные ошибки на **русском языке**.
- Выводи всю необходимую информацию о полученных данных в чат.

### 5. Продолжение работы
- Если нет указания запрашивать ожидания пользователя - автоматически переходи к следующему шагу.
- Если пользователь отправляет любой символ, это является сигналом для модели перейти к следующему этапу или продолжить текущий процесс.

### 6. Проверка и восстановление файлов
Если в процессе работы обнаружится, что распакованные файлы недоступны или отсутствуют:
- Сообщи пользователю: "Распакованные файлы не обнаружены. Пожалуйста, загрузите архив снова, чтобы продолжить работу."
- Дождись загрузки архива от пользователя.
- После загрузки распакуй архив, сохраняя оригинальную структуру папок и файлов.
- Убедись, что пути в файле `progress.json` совпадают с распакованными файлами.
- Продолжи обработку с того места, где остановился, используя `progress.json` для определения текущего статуса выполнения.


## Этапы выполнения работ

### 1. Распаковка архива
- Разархивируй содержимое архива, сохраняя структуру папок.


### 2. Удаление ненужных файлов и папок
- Рекурсивно пройти по всем распакованным папкам и файлам, начиная с корневой папки модуля.
- Удалить все файлы и папки, названия которых:
    - Начинаются с нижнего подчёркивания _, включая системные папки, такие как __MACOSX.
    - Называются .DS_Store.
    - Называются lang, включая все вложенные файлы и папки внутри этих директорий.
    - Удаление папки следует начинать с удаления всех файлов и папок, находящихся внутри неё.


### 3. Подготовка файла прогресса

#### 3.1 Создлание файла прогресса
- Создай и инициализируй файл `progress.json`. 
- JSON Schema для `progress.json`:
```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "properties": {
        "name": {
            "type": "string",
            "description": "Название папки или файла"
        },
        "absolute_path": {
            "type": "string",
            "description": "Абсолютный путь к папке или файлу"
        },
        "relative_path": {
            "type": "string",
            "description": "Относительный путь к папке или файлу от корня модуля"
        },
        "type": {
            "type": "string",
            "enum": ["folder", "file"],
            "description": "Тип объекта: папка или файл"
        },
        "processed": {
            "type": "boolean",
            "description": "Отметка о том, обработан ли файл или папка"
        },
        "children": {
            "type": "array",
            "description": "Вложенные папки и файлы",
            "items": { "$ref": "#" }
        }
    },
    "required": ["name", "absolute_path", "relative_path", "type", "processed"],
    "additionalProperties": false
}
```

#### 3.2 Заполнение файла прогресса
- Начни с корневой папки модуля, но если она имеет во вложении папку с таким же названием **не добавляй её как элемент в структуру**.
- Построй структуру, начиная с содержимого корневой папки (вложенные папки и файлы).
- Проходи по списку файлов и папок, отбирая только те, которые имеют расширения .php, .js и .css, за исключением папок с названием lang и всех папок и файлов, хранящихся в них.
- Для каждой подходящей папки и файла создавай соответствующий объект в progress.json согласно JSON Schema. Указывай два пути:
    - absolute_path: абсолютный путь к файлу или папке, который будет использоваться для операций чтения файлов.
    - relative_path: относительный путь к файлу или папке от корня модуля, начиная с / (например, /simai.mscore/admin/index.php), который будет использоваться в документации.
- Для отображения иерархической структуры папок и файлов используй children.

#### 3.3 Сортировка файлов и папок в progress.json
- Пройдите рекурсивно по каждому элементу структуры progress.json, начиная с корневой папки.
- Для каждой папки разделите вложенные элементы на две группы: **папки и файлы**.
- Сначала отсортируйте **папки** по алфавиту.
- Затем отсортируйте **файлы** по алфавиту.
- Объедините отсортированные папки и файлы, записав их в таком порядке: сначала папки, затем файлы.
- Для каждой вложенной папки повторите шаги сортировки.


### 4. Создание структуры файлов
- Выполняй поэтапно, каждый шаг должен быть завершен перед переходом к следующему.

### 4.1. Создание файла документации 
- Создай файл документации `doc_{archive_name}.md` с заголовком документации.

#### 4.2. Определение корневой директории
- Определи корневую директорию модуля. Если распакованная директория содержит папку с названием, совпадающим с именем архива (например, `simai.mscore/`), считай её корневой.
- Игнорируй файлы и папки на одном уровне с корневой папкой (например, `doc_simai.mscore.md` и `progress.json`).

#### 4.3. Использование `progress.json` для генерации дерева файлов

##### 4.3.1. Чтение `progress.json`
- Прочитай файл `progress.json`, используй поле `children` для рекурсивного обхода вложенных элементов.

##### 4.3.2. Построение дерева
- Начни с корневой папки и добавь её в дерево (например, `"simai.mscore/"`).
- Для файлов и папок используй:
  - Символы `└──` для последних элементов.
  - Символы `├──` для всех остальных.
  - Добавляй символ `/` для папок.

##### 4.3.3. Формирование отступов
- Для каждого уровня вложенности добавляй отступы:
  - Используй `"│   "` для элементов, которые не являются последними.
  - Для последнего элемента используй `"    "` (четыре пробела).
  - Избегай лишних вертикальных линий под корневой папкой.

##### 4.3.4. Сборка и запись дерева
- Собери дерево файлов и папок, используя данные из `progress.json`.
- Заключи дерево в блок кода (тройные кавычки и указание `markdown`).
- Запиши дерево в раздел “Структура файлов и папок” документации.

**Пример корректного дерева:**
```markdown
   simai.mscore/
   ├── handler/
   │   └── typeschool.php
   ├── install/
   │   ├── index.php
   │   └── version.php
   ├── include.php
   ├── admin/
   │   ├── on_work.php
   │   ├── iblock.section.edit.php
   │   ├── on_reject.php
   ...
```

##### 4.3.5. Предоставь ссылку на файлы:
- [Ссылка на `doc_{archive_name}.md`](#)
- [Ссылка на `progress.json`](#)
- Запроси подтверждение от пользователя перед переходом к следующему шагу.


### 5. Обработка файлов и папок

#### 5.1. Прочитай файл `progress.json`
- Найди первый необработанный объект, исключая корневую папку модуля.
- Обрабатывай только вложенные папки и файлы.
- Выведи в чат, какой объект ты будешь обрабатывать, и предоставь следующую информацию:
    - Название
    - `relative_path`: путь относительно корня
    - Тип (папка или файл)

#### !5.2. Для папки:
- Определи назначение папки и перечисли все файлы внутри неё.
- **Выведи в чат и добавь в документ:** 
    - Название папки.
    - Путь `relative_path` относительно корня.
    - Список вложенных файлов.
- **Запроси подтверждение от пользователя перед переходом к следующему шагу.**

#### 5.3. Для файла:

##### 5.3.1. Сбор информации о файле
- **Выведи в чат и добавь в документ:** 
    - Название файла, путь `relative_path` относительно корня и тип файла.
    - Определи назначение файла и кратко опиши его роль.

##### !5.3.2. Глубокий анализ логики работы файла, используя знания об API 1С-Битрикс.
- Проведи глубокий анализ логики работы файла, используя знания об API 1С-Битрикс.
- **Выведи в чат и добавь в документ:** 
    - Описание основных блоков кода, их назначение, и как они взаимодействуют, опираясь на особенности работы с модулями в 1С-Битрикс.
- **Запроси подтверждение от пользователя перед переходом к следующему шагу.**

##### !5.3.4. Обработка констант
- Проверь наличие констант в файле, используя поиск по ключевым словам `define` и `const`. Убедись, что фиксируешь не только название, но и значение каждой константы.
- **Если константы найдены:** Выведи в чат и добавь в документ все константы, укажи их название и значение.
- **Если константы отсутствуют:** Сообщи об этом в чате.
- **Запроси подтверждение от пользователя перед переходом к следующему шагу.**

##### !5.3.5. Обработка классов
- Проверь наличие прострнаств имен в файле, используя поиск по ключевым словам `namespace`. 
    - **Выведи в чат и добавь в документ:** все найденные пространства имен.
- Проверь наличие классов в файле. Для каждого класса:
    - Определи его роль в модуле и опиши кратко.
    - **Выведи в чат и добавь в документ:** Перечисли все его методы в формате `Class::Method($param1, $param2)`. Для каждого метода опиши его назначение.
- **Если классы отсутствуют:** Сообщи об этом в чате.
- **Запроси подтверждение от пользователя перед переходом к следующему шагу.**

##### !5.3.6. Обработай функции вне класса
- Проверь, есть ли в файле функции вне класса.
- Для каждой найденной функции:
    - **Выведи в чат и добавь в документ:** Перечисли их в формате `FunctionName($param1, $param2)`, **без привязки к имени класса**. Для каждой функции опиши ее назначение.
- **Если функции вне класса отсутствуют:** Сообщи об этом в чате.
- **Запроси подтверждение от пользователя перед переходом к следующему шагу.**

#### !5.4. Предоставь ссылки на файлы:
- **Перед тем, как запросить подтверждение на продолжение**, предоставь пользователю ссылки на:
    - Файл документации `doc_{archive_name}.md`.
    - Файл прогресса `progress.json`.
- После предоставления ссылок, запроси подтверждение от пользователя перед переходом к следующему шагу.

#### 5.5. Установи `processed: true` для данного объекта в `progress.json`.
- Установите `processed: true` только для текущего объекта в `progress.json` после завершения его обработки и добавления информации в документ. Не изменяйте статус вложенных объектов.
- Если объект — папка, установите `processed: true` только для этой папки, не отмечая её содержимое.
- Пример: Если обрабатывается папка `lib`, установите `processed: true` только для этой папки, оставляя все вложенные файлы и папки необработанными.

#### 5.6. Выведи в чат количество обработанных объектов и оставшееся количество.
- **Запроси подтверждение от пользователя перед переходом к следующему шагу.**

#### 5.7. Повторяй цикл обработки, пока не будут обработаны все объекты в `progress.json`.
- Если есть вложенные необработанные объекты обрабатывай их, пока все объекты не будут обработаны. 

### 6. Создание общего описания модуля

#### 6.1. Анализ информации:

- Прочитай все собранные данные о файлах, папках и функциональности модуля, уже записанные в документ.
- Выдели ключевые особенности и функциональные возможности модуля, такие как:
- Основное назначение модуля и решаемые задачи.
- Основные классы и их взаимодействие.
- Ключевые функции и их роль в работе модуля.
- Особенности и отличия от стандартной функциональности, если они есть.

#### 6.2. Подготовка черновика описания:

- Составь подробное общее описание модуля, включив в него:
- Назначение модуля: укажи его основную цель и задачи, которые он решает в системе.
- Основную структуру модуля: кратко упомяни, как организованы файлы и папки, не повторяя их список.
- Основные функциональные возможности: перечисли и опиши основные задачи, которые реализует модуль.
- Используемые классы: упомяни основные классы, их назначение и как они взаимодействуют друг с другом.
- Главные функции: перечисли ключевые функции и кратко укажи их роль.
- Особенности и преимущества модуля: если модуль имеет уникальные особенности или отличается от стандартной реализации, опиши их.
- Добавь все описания в один связный раздел "Описание модуля".

#### 6.3. Редактирование и корректировка:

- Проверь черновик описания на предмет полноты и связности.
- Добавь или уточни детали, чтобы создать полное представление о функциональности модуля.

#### 6.4. Запись в документ:

- После завершения редактирования добавь раздел "Описание модуля" в начало документа `documentation_temp.md`.
- Сообщи о завершении записи в чат и предоставь обновленную ссылку на документ.
- Если обнаружишь проблемы (например, недостающие или некорректные ссылки), исправь их.
- Сообщи пользователю, что проверка завершена, и предоставь обновленную ссылку на документ.

