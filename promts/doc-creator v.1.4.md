# Создание полной и подробной документации для модуля

## Описание задачи

Необходимо создать **полную и подробную документацию** по модулю из предоставленного архива в формате **Markdown** на **русском языке**. 

## Термины и определения

- **Основной файл документации** — файл, который содержит полное описание модуля, его структуры, классов, методов и функций. Этот файл объединяет все данные о модуле.
- **Временный файл документации** — временный файл, создаваемый для каждого отдельного файла модуля. В него записываются описания классов, методов, констант или функций для конкретного файла.
- **Основной файл прогресса** — файл `progress.json`, в котором фиксируется информация о всех папках и файлах модуля.
- **Временный файл прогресса** — временный файл для фиксации прогресса обработки элементов внутри конкретного файла.
- **Текущий файл** — объект `progress.json` типа `файл`, который в данный момент обрабатывается. 
- **Константа** — переменная, значение которой не изменяется. Описывается её имя, значение и назначение.
- **Класс** — основная структура в объектно-ориентированном программировании, объединяющая свойства и методы.
- **Метод** — функция, принадлежащая классу, описывающая логику взаимодействия с классом.
- **Функция** — структура, выполняющая задачу и не привязанная к классу.
- **Модуль** — самостоятельная единица кода, реализующая определённую функциональность и подключаемая к системе.

## Требования к процессу:

**Точность действий**
- Все действия должны **строго следовать инструкциям**, данным ниже. Если шаг не описан или неясен, остановитесь и запросите уточнение у пользователя.
- **Используй для генерации ответов минимальную температуру** (0 или близкую к 0), чтобы обеспечить максимальную последовательность в выводе и избежать различий при повторном использовании промта.
- **Тщательно соблюдай все шаги указанные в промте**!

**Циклы их вложенность**
- Данный промт содержить 2 (два) цикла:
    - В рамках первого цикла обрабатываются элементы файла прогресса `progress.json`
    - В рамках второго (который вложен в первый) обрабатываются отдельные элементы **текущего файла** которые отражены в файле `file_name.json`.
- **Все действия в циклах должны отрабатываться шаг за шагом отдельно без объединения в один блок работ**    

**Разбиение работы**
- Разбей всю работу на логические блоки работы, которые можно выполнять по отдельности.
- Циклы должны обрабтываться последовательно. **Запрещается выполнять цикл за один блок**.
- Продолжительность обработки одного блока работы не должна превышать 30 секунд.

**Режим проверки**
- После выполнения каждого шага проверь насколько он соотвествует заданному промту. Если не соотвествует - переделай так чтобы соотвесствовало.

**Журналирование**
- Веди журнал обработки, фиксируя ключевые этапы выполнения и возможные ошибки на **русском языке**.
- Выводи всю необходимую информацию о полученных данных в чат.

**Продолжение работы**
- Если нет указания запрашивать ожидания пользователя - автоматически переходи к следующему шагу.
- Если пользователь отправляет любой символ, это является сигналом для модели перейти к следующему этапу или продолжить текущий процесс.

**Проверка и восстановление файлов**
Если в процессе работы обнаружится, что распакованные файлы недоступны или отсутствуют:
- Сообщи пользователю: "Распакованные файлы не обнаружены. Пожалуйста, загрузите архив снова, чтобы продолжить работу."
- Дождись загрузки архива от пользователя.
- После загрузки распакуй архив, сохраняя оригинальную структуру папок и файлов.
- Убедись, что пути в файле `progress.json` совпадают с распакованными файлами.
- Продолжи обработку с того места, где остановился, используя `progress.json` для определения текущего статуса выполнения.

## Этапы выполнения работ

### Этап 1. Распаковка архива

1.1 Разархивируй содержимое архива, сохраняя структуру папок.

### Этап 2. Удаление ненужных файлов и папок

2.1. Рекурсивно пройди **по всем папкам и файлам**.
- Удали **все файлы и папки**, названия которых:
    - Начинаются с нижнего подчёркивания (_).
    - Называются `.DS_Store`.
    - Называются `lang`, включая все вложенные файлы и папки внутри этих директорий.
- Удаление папки следует начинать с удаления всех файлов и папок, находящихся внутри неё.
2.2. После удаления всех указанных файлов **еще раз проверь все папки и файлы** на наличие папок и факлов которые необхожимо удалить.
2.3. После положительной проверки, переходи к 3 этапу. 

### Этап 3. Подготовка файла прогресса

Шаги подготовки файла прогресса:

3.1. **Создай и инициализируй основной файл прогресса `progress.json`.** 

**JSON Schema для `progress.json`:**
```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "properties": {
        "name": {
            "type": "string",
            "description": "Название папки или файла"
        },
        "absolute_path": {
            "type": "string",
            "description": "Абсолютный путь к папке или файлу"
        },
        "relative_path": {
            "type": "string",
            "description": "Относительный путь к папке или файлу от корня модуля"
        },
        "type": {
            "type": "string",
            "enum": ["folder", "file"],
            "description": "Тип объекта: папка или файл"
        },
        "processed": {
            "type": "boolean",
            "description": "Отметка о том, обработан ли файл или папка"
        },
        "children": {
            "type": "array",
            "description": "Вложенные папки и файлы",
            "items": { "$ref": "#" }
        }
    },
    "required": ["name", "absolute_path", "relative_path", "type", "processed"],
    "additionalProperties": false
}
```
3.2. **Заполни файл прогресса `progress.json`:**
- Начни с корневой папки модуля, но если она имеет во вложении папку с таким же названием **не добавляй её как элемент в структуру**.
- Построй структуру, начиная с содержимого корневой папки (вложенные папки и файлы).
- **Рекурсивно** проходи по всем вложенным папкам:
  - Для каждой папки проходи по её содержимому и заполняй вложенные файлы и папки.
  - Для вложенных элементов (файлы или папки) также заполняй поля `absolute_path` и `relative_path`.
- Обрабатывай **все вложенные директории** до самого глубокого уровня вложенности.
- Для каждой подходящей папки и файла создавай соответствующий объект в `progress.json` согласно JSON Schema.
- Для отображения иерархической структуры папок и файлов используй children.

**ВАЖНО! Пропускай следующие файлы и папки. Не добавляй их в структуру:**
- Все файлы названия которых начинаются с нижнего подчёркивания (_).
- Все папки названия которых начинаются с нижнего подчёркивания (_) включая все вложенные файлы и папки внутри этих директорий.
- Все файлы с название `.DS_Store`.
- Все папки с названием `lang`, включая все вложенные файлы и папки внутри этих директорий.

3.3. **Проверь корректность заполнения файла прогресса `progress.json`.**
- После корректного заполнения файла прогресса `progress.json` переходи к 4 этапу. 


### Этап 4. Сортировка папок и файлов в `progress.json`

**Произведи сортировку файлов и папок** в `progress.json` согласно следующим правилам:

4.1. **Сортировка файлов и папок должна выполняться отдельно:**
- Сначала необходимо отсортировать **все файлы** в текущей директории в **алфавитном порядке**.
- После сортировки файлов необходимо отсортировать **все папки** в этой же директории также в **алфавитном порядке**.
- **Важно**: Файлы должны быть указаны **перед** папками на каждом уровне вложенности.

**Пример:**
    ```
    ├── a.php
    ├── b.php
    ├── c.js
    ├── config/
    └── scripts/
    ```

4.2. **Применяйте этот принцип рекурсивно:**
- Для каждой папки повторите процесс: сначала сортируйте файлы, затем папки на каждом уровне.
- Этот порядок должен сохраняться для всех подкаталогов, начиная с корневой директории.

4.3. **Правила сортировки для каждого уровня:**
- На каждом уровне сначала идут файлы по алфавиту, затем папки.

4.4. **Проверь структуру после сортировки:**
- **Обязательно выведи в чат** текущую структуру после сортировки, чтобы убедиться в правильности порядка элементов.

**Пример корректной сортировки:**
```
simai.mscore/
├── include.php
├── install/
│   ├── index.php
│   └── version.php
├── lib/
└── scripts/
```

4.5. **Запиши файл прогресса только после сортировки:**
- Убедись, что структура отсортирована корректно на всех уровнях вложенности.
- Только после подтверждения сортировки переходи к обновлению файла прогресса  `progress.json`.


### Этап 5. Создание структуры файлов и папок

Шаги подготовки структуры файлов и папок:

5.1. **Создай **основной файл документации** `doc_{archive_name}.md` с заголовком документации.

5.2. **Определи корневую директорию модуля:**
- Если распакованная директория содержит папку с названием, совпадающим с именем архива (например, `simai.mscore/`), считай её корневой.
- Игнорируй файлы и папки на одном уровне с корневой папкой (например, `doc_simai.mscore.md` и `progress.json`).

5.3. **Прочитай основной файл прогресса `progress.json`, используй поле `children` для рекурсивного обхода вложенных элементов.**

5.4. **Построй дерево:**
- Начни с корневой папки и добавь её в дерево (например, `"simai.mscore/"`) **без символов перед ней**.
- Для файлов и папок на каждом уровне используй следующие символы:
  - Символы `├──` для всех элементов, кроме последнего.
  - Для **последнего элемента на уровне** используй символ `└──`, чтобы указать на конец ветки.
  - Используй вертикальные линии `"│   "` для всех уровней, кроме последнего элемента на уровне.
  - Добавляй символ `/` для всех папок.
  - Если элемент является папкой, рекурсивно обработай его содержимое с отступами и символами.

5.5. **Для каждого уровня вложенности добавляй отступы:**
- Используй символы `"│   "` для элементов, которые не являются последними на уровне.
- Для последнего элемента на уровне добавляй `"    "` (четыре пробела) перед символом `└──`.
- Корневая папка (например, `"simai.mscore/"`) должна отображаться **без символов**.

5.6. **Собери дерево файлов и папок, используя данные из `progress.json`:**
- Начни с корневой папки и добавь её в дерево (например, `"simai.mscore/"`) **без символов перед ней**.
- Для файлов и папок на каждом уровне используй следующие символы:
  - Символы `├──` для всех элементов, кроме последнего.
  - Для **последнего элемента на уровне** используй символ `└──`, чтобы указать на конец ветки.
  - Используй вертикальные линии `"│   "` для всех уровней, кроме последнего элемента на уровне.
  - Добавляй символ `/` для всех папок.

**Пример корректного дерева:**
```markdown
simai.mscore/
├── include.php
├── install/
│   ├── index.php
│   └── version.php
└── lib/
    ├── config/
    └── highload/
```
- Убедись, что в основной файл документации дерево добавлено как блок кода.

5.7. **Выведи в чат ссылки на файлы:**
- [Ссылка на `doc_{archive_name}.md`](#)
- [Ссылка на `progress.json`](#)


### Этап 6. Обработка файлов и папок

Шаги обработки файлов и папок:

6.1. **Прочитай файл `progress.json`.**

6.2. **Найди первый необработанный объект, исключая корневую папку модуля.**

6.3. **Выведи в чат, какой объект ты будешь обрабатывать, и предоставь следующую информацию:**
- Название
- `relative_path`: путь относительно корня
- Тип (папка или файл)

6.4. **Для папки:**
- Определи назначение папки и перечисли все файлы внутри неё.
- **ВАЖНО!** Перед обработкой файлов в папке, обязательно **выведи в чат и добавь в файл `doc_{archive_name}.md`**:
  - Название папки.
  - Путь `relative_path` относительно корня.
  - Список вложенных файлов.
- После обработки информации о папке, обязательно добавляй её в **основной файл документации** `doc_{archive_name}.md`.
- Только после этого переходи к обработке файлов внутри этой папки.

6.5. **Для файла:**
- **ВАЖНО!** Далее этот файл будет называться **текущий файл**.
- Убедись что перед обработкой файла информация о вышестоящей папке была уже обработана и добавлена в файл `doc_{archive_name}.md`

6.5.1. **Создание временного файла прогресса для файла** `file_name.json`**:**
- Создайте `file_name.json` как массив объектов, каждый из которых представляет элемент файла.
- Определите уникальный id для каждого элемента и используйте parent_id для обозначения иерархии.

**JSON Schema для временного файла прогресса:**
```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "array",
  "description": "Список элементов файла",
  "items": {
    "type": "object",
    "required": ["id", "name", "type", "processed"],
    "additionalProperties": false,
    "properties": {
      "id": {
        "type": "integer",
        "description": "Уникальный идентификатор элемента"
      },
      "name": {
        "type": "string",
        "description": "Название элемента"
      },
      "type": {
        "type": "string",
        "enum": ["function", "class", "method", "property"],
        "description": "Тип элемента"
      },
      "processed": {
        "type": "boolean",
        "description": "Отметка о том, обработан ли элемент"
      },
      "parent_id": {
        "type": ["integer", "null"],
        "description": "ID родительского элемента или `null`, если элемент находится на верхнем уровне"
      }
    }
  }
}
```

6.5.2. **Анализ содержимого текущего файла:**
- Прочтите содержимое файла и заполните массив элементов, собирая информацию о каждом элементе и его связи с родительскими элементами.

6.5.3. **Заполнение** `file_name.json`**:**
- Заполните массив элементов в соответствии со структурой.
- Убедитесь, что все необходимые поля присутствуют и правильно заполнены.
- Пример заполненного `file_name.json`:
```json
[
  {
    "id": 1,
    "name": "MyClass",
    "type": "class",
    "processed": false,
    "parent_id": null
  },
  {
    "id": 2,
    "name": "__construct",
    "type": "method",
    "processed": false,
    "parent_id": 1
  },
  {
    "id": 3,
    "name": "myMethod",
    "type": "method",
    "processed": false,
    "parent_id": 1
  },
  {
    "id": 4,
    "name": "my_function",
    "type": "function",
    "processed": false,
    "parent_id": null
  }
]
```

6.5.4. **Создание временного файла документации** `temp_file_name.md`**:**
- Используйте информацию из `file_name.json` для последовательной обработки и документирования каждого элемента.
- Структурируйте документ согласно иерархии элементов, используя parent_id для определения вложенности.

6.5.5. **После прочтения содержимого текущего файла, заполни `file_name.json`:**
- Добавь **все константы, классы, методы и функции** найденные в текущем файле.
- **Методы добавляй только для класса который есть в этом файлев.** Методы из внешних классов добавлять не нужно
- Для отображения иерархической структуры папок и файлов используй children.
- Для **каждого элемента** установи `processed: false`.

6.5.6. **После заполнения `file_name.json`, создай временный файл документации для файла `temp_file_name.md`, в который будет вноситься информация по текущему файлу.**
- Создай временный Markdown-файл, используя заголовки **со второго уровня** (начиная с `##`).
- Добавь в фай `temp_file_name.md`:
  - Название файла в виде заголовка второго уровня: `## file_name`.
  - Путь `relative_path` относительно корня.
- Для секций внутри файла используй заголовки третьего уровня: `### Константы`, `### Классы`, `### Методы`.

**Выведи сообщение в чат после успешного создания временного файла документации.**

6.5.7. **Обработка констант**:
- Собери список всех констант, которые найдены в текущем файле.
- Для каждой константы выведи её имя и значение.
- Если возможно, добавь краткое описание для каждой константы.
- Добавь весь список констант как единый блок в временный файл документации `temp_file_name.md`.

**Пример для вывода констант в документации:**
```markdown
### Константы

- `SF_SOLUTION_NAME`: "SIMAI Framework" — Название решения.
- `SF_SOLUTION_LINK`: "https://simai.ru" — Ссылка на сайт решения.
- `SF_VERSION`: "1.0.0" — Текущая версия решения.
```

6.5.8. **Обработка элементов из `file_name.json`:**

- Прочитай `file_name.json` и найдите первый элемент в `elements`, у которого `processed: false`.
- **ВАЖНО: Если это класс то сначала обработай методы класса**. Когда все методы в классе будут обработаны - обработай класс.
    
6.5.9. **ВАЖНО! После прочтения содержимого текущего файла  Обработай элемент в зависимости от типа согласно инструкциям ниже**

**ДЛЯ КЛАССА:**
- **Класс должен обрабатываться после обработки всех методов входящих в этот класс.**
- Проведи **глубокий** анализ класса, **используя знания об API 1С-Битрикс** и описания методов
- **Добавь в файл `temp_file_name.md`:** 
    - Имя класса,
    - Пространство имен класса,
    - **Подробное** описание класса на основе анализа.

**ДЛЯ МЕТОДА:**
- Проведи **глубокий** анализ метода. 
- **Добавь в файл `temp_file_name.md`:** 
    - Вызов метода в формате `Class::Method($param1, $param2)`, используя полные сигнатуры методов.
    - Логику и назначение метода, включая возможные взаимодействия с другими частями кода.
    - **Обрати внимание на наличие модификаторов доступа** (public, private, protected) для методов и укажи их в описании. Объясни, как они влияют на доступ к методам внутри и за пределами класса.

**ДЛЯ ФУНКЦИИ:**
- Проведи **глубокий** анализ функции. 
- **Добавь в файл `temp_file_name.md`:** 
    - Вызов функции в формате `FunctionName($param1, $param2)`, **без привязки к имени класса**.
    - Логику и назначение функции, включая возможные взаимодействия с другими частями кода.
    - Опиши назначение и логику функции, укажи параметры, которые они принимают, , **используя знания об API 1С-Битрикс**, что они возвращают, и взаимодействуют ли они с глобальными переменными или объектами.

6.5.10. **После обрабтки элемента, установи `processed: true` для данного объекта в `file_name.json`.**
- Установите `processed: true` только для текущего объекта в `file_name.json` после завершения его обработки. Не изменяйте статус вложенных объектов.
- Если объект — **класс**, установите `processed: true` только для этого класса, не отмечая его содержимое.

6.5.11. **После установки `processed: true` для данного объекта в `file_name.json`, Выведи в чат ссылки на файлы:**
- Временный файл документации файла `temp_{file_name}.md`.
- Файл прогресса файла `file_name.json`.

6.5.12. **ВАЖНО! Повторяй цикл обработки текущего файла, пока не будут обработаны все объекты в `file_name.json`.**
- **Если есть объекты с `processed: false` вернись на шаг 6.5.8.**
- После **завершения обработки всех элементов** (классы, методы, функции) в `file_name.json` - перейди к шагу 6.5.13.

6.5.13. **После завершения обработки всех элементов в `file_name.json`, проведи анализ содержимого файла `temp_{file_name}.md`.**
Когда все элементы обработаны и файл `temp_{file_name}.md` заполнен:
- Проведи анализ содержимого `temp_{file_name}.md`, чтобы подготовить общее описание **текущего файла** и его логики работы.
- Это описание должно включать:
    - Общее назначение файла и его роль в системе.
    - Основные задачи, которые решает файл, и его значимость в модуле.
- Добавь это описание **в начало файла** `temp_{file_name}.md`.

6.5.14. **СРАЗУ После завершения обработки всех элементов файла и добавления опсиания файла добавь содержимое временного файла в основной документ.**
- Проверь содержимое: открой основной файл документации и убедись, что новый блок действительно присутствует.
- Добавь содержимое временного файла документации (`temp_{file_name}.md`) в основной файл документации (`doc_{archive_name}.md`).
- **Перед переходом к следующему шагу убедись, что шаг 6.5.14 полностью выполнен.**

6.5.15. **Удаление временных файлов:**
- После успешного копирования данных, удали **временный файл документации** для файла (`temp_{file_name}.md`).
- Также удали **временный файл прогресса** для файла (`file_name.json`).
- Проверь, что временные файлы были удалены корректно.

6.5.16. **После завершения обработки всех элементов файла, подготовки описания и копирования данных в основной файл документации переходи к шагу 6.6.**
- Обновите основной файл прогресса `progress.json`, установив флаг `processed: true` для текущего файла.

6.6. **Выведи в чат ссылки на файлы:**
- После успешного удаления временных файлов предоставь ссылки на основной файл документации (`doc_{archive_name}.md`) и обновлённый файл прогресса (`progress.json`) в чат.
- Пример: 
  - [Файл документации doc_{archive_name}.md](#)
  - [Файл прогресса progress.json](#)

6.7. **Установи `processed: true` для данного объекта в `progress.json`.**
- Установите `processed: true` только для текущего объекта в `progress.json` после завершения его обработки и добавления информации в документ. Не изменяйте статус вложенных объектов.
- Если объект — папка, установите `processed: true` только для этой папки, не отмечая её содержимое.
- Пример: Если обрабатывается папка `lib`, установите `processed: true` только для этой папки, оставляя все вложенные файлы и папки необработанными.

6.8. **Выведи в чат количество обработанных объектов и оставшееся количество.**

6.9. **Повторяй цикл обработки папок и файлов, пока не будут обработаны все объекты в `progress.json`.**
- Если есть вложенные необработанные объекты обрабатывай их, пока все объекты не будут обработаны. Для этого вернись к шагу 1. текущего этапа 

6.10. **После завершения обработки всех файлов**
- **После завершения всех объектов этапа 6 автоматически переходи к этапу 7 — созданию общего описания модуля.**

### Этап 7. Создание общего описания модуля

7.1. **Анализ информации:**

- Прочитай все собранные данные о файлах, папках и функциональности модуля, уже записанные в документ.
- Выдели ключевые особенности и функциональные возможности модуля, такие как:
- Основное назначение модуля и решаемые задачи.
- Основные классы и их взаимодействие.
- Ключевые функции и их роль в работе модуля.
- Особенности и отличия от стандартной функциональности, если они есть.

7.2. **Подготовка черновика описания:**

- Составь подробное общее описание модуля, включив в него:
- Назначение модуля: укажи его основную цель и задачи, которые он решает в системе.
- Основную структуру модуля: кратко упомяни, как организованы файлы и папки, не повторяя их список.
- Основные функциональные возможности: перечисли и опиши основные задачи, которые реализует модуль.
- Используемые классы: упомяни основные классы, их назначение и как они взаимодействуют друг с другом.
- Главные функции: перечисли ключевые функции и кратко укажи их роль.
- Особенности и преимущества модуля: если модуль имеет уникальные особенности или отличается от стандартной реализации, опиши их.
- Добавь все описания в один связный раздел "Описание модуля".

7.3. **Редактирование и корректировка:**

- Проверь черновик описания на предмет полноты и связности.
- Добавь или уточни детали, чтобы создать полное представление о функциональности модуля.

7.4. **Запись в документ:**

- После завершения редактирования добавь раздел "Описание модуля" **в начало** документа `doc_{archive_name}.md`.
- Сообщи о завершении записи в чат и предоставь обновленную ссылку на документ.
- Если обнаружишь проблемы (например, недостающие или некорректные ссылки), исправь их.
- Сообщи пользователю, что проверка завершена, и предоставь обновленную ссылку на документ.

7.5. **Предоставь ссылки на файлы:**
- Файл документации `doc_{archive_name}.md`.
- Файл прогресса `progress.json`.

